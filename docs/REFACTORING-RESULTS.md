# üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ ‚Äî –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

**–î–∞—Ç–∞:** 24 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª —Å –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞–º–∏
**–§–∞–π–ª:** `nodes/Soniox/constants.ts`

–í—Å–µ –º–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ –∏ —Å—Ç—Ä–æ–∫–∏ –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ:
- `API_LIMITS` ‚Äî –ª–∏–º–∏—Ç—ã –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ (100, 50)
- `CONTENT_TYPES` ‚Äî MIME —Ç–∏–ø—ã (JSON, Binary, FormData)
- `RETRY_CONFIG` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
- `TIMEOUTS` ‚Äî —Ç–∞–π–º–∞—É—Ç—ã –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ (30s, 60s –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏)
- `RETRYABLE_STATUS_CODES` ‚Äî –∫–æ–¥—ã –æ—à–∏–±–æ–∫ –¥–ª—è retry

### 2. –£—Å—Ç—Ä–∞–Ω–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ Authorization Header
**–§–∞–π–ª—ã:** `credentials/SonioxApi.credentials.ts`, `nodes/Soniox/GenericFunctions.ts`

**–ë—ã–ª–æ:**
- Header —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è –≤ 2 –º–µ—Å—Ç–∞—Ö ‚Üí –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã

**–°—Ç–∞–ª–æ:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `requestWithAuthentication` –∏–∑ n8n-workflow
- Header —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ `credentials.authenticate`
- –£–±—Ä–∞–Ω–∞ —Ä—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ `GenericFunctions.ts`

### 3. –î–æ–±–∞–≤–ª–µ–Ω–∞ Retry –ª–æ–≥–∏–∫–∞
**–§–∞–π–ª:** `nodes/Soniox/GenericFunctions.ts`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- ‚úÖ Exponential backoff (1s ‚Üí 2s ‚Üí 4s ‚Üí max 10s)
- ‚úÖ –ú–∞–∫—Å–∏–º—É–º 3 –ø–æ–ø—ã—Ç–∫–∏
- ‚úÖ Retry –¥–ª—è –∫–æ–¥–æ–≤: 408, 429, 500, 502, 503, 504
- ‚úÖ Retry –ø—Ä–∏ ETIMEDOUT, ECONNRESET
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ Rate Limiting (429) —Å `Retry-After` –∑–∞–≥–æ–ª–æ–≤–∫–æ–º
- ‚úÖ –¢–∞–π–º–∞—É—Ç—ã: 30s –¥–ª—è API, 60s –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤

### 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç –≤–æ –≤—Å–µ—Ö —Ñ–∞–π–ª–∞—Ö
**–û–±–Ω–æ–≤–ª–µ–Ω—ã:**
- `nodes/Soniox/GenericFunctions.ts` ‚Äî CONTENT_TYPES, API_LIMITS, TIMEOUTS, RETRY_CONFIG
- `nodes/Soniox/Soniox.node.ts` ‚Äî CONTENT_TYPES.BINARY
- `nodes/Soniox/descriptions/FileDescription.ts` ‚Äî API_LIMITS
- `nodes/Soniox/descriptions/TranscriptionDescription.ts` ‚Äî API_LIMITS

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞

### –°–±–æ—Ä–∫–∞
```bash
npm run build
```
‚úÖ **–£—Å–ø–µ—à–Ω–æ** ‚Äî –Ω–µ—Ç –æ—à–∏–±–æ–∫ TypeScript

### –õ–∏–Ω—Ç–µ—Ä
```bash
npm run lint
```
‚úÖ **–£—Å–ø–µ—à–Ω–æ** ‚Äî –Ω–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π ESLint

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ö–∞—Ä–¥–∫–æ–¥–∏–Ω–≥–∞
```bash
grep -r "application/octet-stream\|application/json\|limit = 100\|limit = 50" nodes/
```
‚úÖ **–£—Å–ø–µ—à–Ω–æ** ‚Äî –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã

---

## üîÑ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –≤ –ø–æ–≤–µ–¥–µ–Ω–∏–∏

### API –∑–∞–ø—Ä–æ—Å—ã —Ç–µ–ø–µ—Ä—å:
1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è** –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö
2. **–°–æ–±–ª—é–¥–∞—é—Ç rate limits** ‚Äî –∂–¥—É—Ç –≤—Ä–µ–º—è –∏–∑ `Retry-After`
3. **–ò–º–µ—é—Ç —Ç–∞–π–º–∞—É—Ç—ã** ‚Äî –Ω–µ –∑–∞–≤–∏—Å–∞—é—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ
4. **–ò—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é** ‚Äî —á–µ—Ä–µ–∑ n8n credentials API

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å—Ç–∞–ª–∞:
1. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π** ‚Äî –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
2. **–õ–µ–≥–∫–æ –∏–∑–º–µ–Ω—è–µ–º–æ–π** ‚Äî –æ–¥–Ω–æ –º–µ—Å—Ç–æ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤
3. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π** ‚Äî –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏

---

## üìù –°–ø–∏—Å–æ–∫ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –∑–∞–¥–∞—á

### üü° –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

#### 1. –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∞ ID –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –∑–∞–ø—Ä–æ—Å–∞

**–ì–¥–µ:** `nodes/Soniox/Soniox.node.ts`

**–ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å:**
```typescript
// –í–∞–ª–∏–¥–∞—Ü–∏—è fileId
if (!fileId || typeof fileId !== 'string' || fileId.trim() === '') {
    throw new NodeOperationError(
        this.getNode(),
        'File ID is required and must be a non-empty string',
        { itemIndex: i }
    );
}
```

**–ü—Ä–∏–º–µ–Ω–∏—Ç—å –¥–ª—è:**
- `fileId` (–æ–ø–µ—Ä–∞—Ü–∏–∏ get, delete)
- `transcriptionId` (–æ–ø–µ—Ä–∞—Ü–∏—è get)
- `model` (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è API)

---

#### 2. –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API
**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–∞–∑–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–µ–∑ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫

**–ì–¥–µ:** `nodes/Soniox/GenericFunctions.ts`

**–ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å:**
```typescript
catch (error: any) {
    const apiError = error.response?.body?.error;
    throw new NodeApiError(this.getNode(), error, {
        message: apiError?.message || 'Soniox API request failed',
        description: apiError?.details,
        httpCode: error.statusCode?.toString(),
    });
}
```

**–ü–æ–ª—å–∑–∞:**
- –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º API
- –£–ø—Ä–æ—â–µ–Ω–∏–µ –æ—Ç–ª–∞–¥–∫–∏

---

### üü¢ –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

#### 3. –£–ª—É—á—à–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è MIME —Ç–∏–ø–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞:** Fallback –Ω–∞ `application/octet-stream` –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –¥–ª—è –∞—É–¥–∏–æ

**–ì–¥–µ:** `nodes/Soniox/Soniox.node.ts:113`

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –§—É–Ω–∫—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è MIME –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é
function getMimeType(fileName: string, fallback: string): string {
    const ext = fileName.split('.').pop()?.toLowerCase();
    const mimeMap: Record<string, string> = {
        'wav': 'audio/wav',
        'mp3': 'audio/mpeg',
        'flac': 'audio/flac',
        'ogg': 'audio/ogg',
        'm4a': 'audio/mp4',
    };
    return mimeMap[ext || ''] || fallback;
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
contentType: binaryData.mimeType || getMimeType(uploadFileName, CONTENT_TYPES.BINARY)
```

---

#### 4. Debug –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –ª–æ–≥–æ–≤ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–æ–±–ª–µ–º –≤ production

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ n8n Logger

```typescript
import { Logger } from 'n8n-workflow';

// –í —Ñ—É–Ω–∫—Ü–∏–∏ sonioxApiRequest
this.logger?.debug(`Soniox API Request: ${method} ${endpoint}`, {
    attempt,
    statusCode,
    hasFormData: !!option.formData,
});
```

**–ü—Ä–∏–º–µ–Ω–∏—Ç—å –¥–ª—è:**
- –ù–∞—á–∞–ª–æ/–∫–æ–Ω–µ—Ü –∑–∞–ø—Ä–æ—Å–∞
- Retry –ø–æ–ø—ã—Ç–∫–∏
- Rate limiting
- –û—à–∏–±–∫–∏

---

#### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ retry —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–æ–¥—ã
**–ò–¥–µ—è:** –ü–æ–∑–≤–æ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ retry

**–î–æ–±–∞–≤–∏—Ç—å –≤ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–¥—ã:**
```typescript
{
    displayName: 'Retry Options',
    name: 'retryOptions',
    type: 'collection',
    placeholder: 'Add Retry Option',
    default: {},
    options: [
        {
            displayName: 'Max Retries',
            name: 'maxRetries',
            type: 'number',
            default: 3,
            description: 'Maximum number of retry attempts',
        },
        {
            displayName: 'Enable Auto Retry',
            name: 'enableRetry',
            type: 'boolean',
            default: true,
            description: 'Whether to automatically retry failed requests',
        },
    ],
}
```

---

#### 6. –¢–µ—Å—Ç—ã –¥–ª—è retry –ª–æ–≥–∏–∫–∏
**–°–æ–∑–¥–∞—Ç—å:** `nodes/Soniox/__tests__/GenericFunctions.test.ts`

**–ü–æ–∫—Ä—ã—Ç—å:**
- –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å –ø–µ—Ä–≤–æ–π –ø–æ–ø—ã—Ç–∫–∏
- Retry –ø—Ä–∏ 500 –æ—à–∏–±–∫–µ
- Retry –ø—Ä–∏ 429 —Å Retry-After
- Retry –ø—Ä–∏ ETIMEDOUT
- –ü—Ä–µ–∫—Ä–∞—â–µ–Ω–∏–µ retry –ø–æ—Å–ª–µ MAX_RETRIES
- Exponential backoff –∑–∞–¥–µ—Ä–∂–∫–∏

---

#### 7. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
**–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏:**
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ retry –ø–æ–ø—ã—Ç–æ–∫
- –ß–∞—Å—Ç–æ—Ç–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫

---

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ | 6 |
| –§–∞–π–ª–æ–≤ —Å–æ–∑–¥–∞–Ω–æ | 2 |
| –°—Ç—Ä–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–æ | ~120 |
| –°—Ç—Ä–æ–∫ —É–¥–∞–ª–µ–Ω–æ | ~20 |
| –•–∞—Ä–¥–∫–æ–¥ —É—Å—Ç—Ä–∞–Ω—ë–Ω | 100% |
| –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç | 100% |

---

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:
- ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ dev –æ–∫—Ä—É–∂–µ–Ω–∏–∏
- ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é –≤ `package.json` (0.1.0 ‚Üí 0.2.0)
- ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å `CHANGELOG.md`

### –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è:
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Å—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç #1)
- –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ (—Å—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç #2)

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:
- –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π
- –î–æ–±–∞–≤–∏—Ç—å debug –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É retry —á–µ—Ä–µ–∑ UI

---

## ‚ú® –í—ã–≤–æ–¥—ã

–ö–æ–¥ —Ç–µ–ø–µ—Ä—å:
- ‚úÖ **–ù–∞–¥—ë–∂–Ω–µ–µ** ‚Äî retry –∏ —Ç–∞–π–º–∞—É—Ç—ã
- ‚úÖ **–ß–∏—â–µ** ‚Äî –Ω–µ—Ç —Ö–∞—Ä–¥–∫–æ–¥–∏–Ω–≥–∞
- ‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–µ–µ** ‚Äî –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–µ–µ** ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–µ–µ** ‚Äî –ª–µ–≥–∫–æ –∏–∑–º–µ–Ω—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
